[
  {
    "Id": "1290904",
    "ThreadId": "561459",
    "Html": "Hello all<br />\n<br />\nI know its probably a faux pas but i have used both rateit and raty to create my 'working' star rating system but im having issues getting the current votes to work on page load and go in the 'response' element (im going to rename it) I'll add the 2 pieces of code that make t function to give an idea of where i am and will make a 2nd php file for this if needed.<br />\n<br />\nIf anyone could offer a suggestion id much appreciate it.<br />\n<br />\nThanks in advance.<br />\n<br />\nHTML<br />\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n&lt;?php require 'core/init.php'; ?&gt;\n    &lt;head&gt;\n        &lt;script src=&quot;//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js&quot;&gt;&lt;/script&gt;    \n        &lt;meta charset=&quot;utf-8&quot;&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div&gt;\n            &lt;table&gt;\n                &lt;tr&gt;\n                    &lt;td&gt;&lt;div id=&quot;randomtest&quot; class=&quot;star&quot;&gt;&lt;/div&gt;&lt;/td&gt;\n                    &lt;td id=&quot;response&quot;&gt;&lt;/td&gt;\n                &lt;/tr&gt;\n            &lt;/table&gt; \n        &lt;/div&gt;\n        \n        &lt;script type=&quot;text/javascript&quot; src=&quot;star/assets/js/jquery.raty.min.js&quot;&gt;&lt;/script&gt;\n        &lt;script type=&quot;text/javascript&quot;&gt;\n        \n        $(function() {\n            $.fn.raty.defaults.path = 'star/assets/img';\n            $('.star').raty({\n                \n                half      : true,\n                number    : 5,\n                score     : 3,\n                \n                click: function(score, evt) {\n                /*implement this for only click once \n                 * $(this).find('img').unbind('click');\n                 */\n                \n                var pid=$(this).prop('id');\n                \n                    $.ajax({\n                    url: 'rate.php',\n                    data: { score: score, pid:pid },\n                    type: 'POST',\n                     \n                    success: function (data) {\n                        $('#response').empty().append(data + ' Votes.'); // this needs to be done on page load too!\n                    },\n                    error: function (jxhr, msg, err) {\n                        $('#response').append('&lt;li style=&quot;color:red&quot;&gt;' + msg + '&lt;/li&gt;');\n                    }\n                    });\n                }\n            });\n        });\n        &lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;</code></pre>\n\nPHP<br />\n<pre><code>&lt;?php\nrequire 'core/init.php';\n\n$_SESSION['score'] = $_POST['score'];\n$_SESSION['pid'] = $_POST['pid'];\n\n$score  = $_SESSION['score'];\n$pid    = $_SESSION['pid'];\n$ipaddy = $_SERVER['REMOTE_ADDR'];\n$voteCo =array();\n\nif($voteCh = $db-&gt;query(&quot;SELECT * FROM votes&quot;)){\n    if($voteCh-&gt;num_rows){\n        while($row = $voteCh-&gt;fetch_object()){\n            $voteCo[] = $row;\n        }\n        $voteCh-&gt;free();\n    }\n}\n\n$udVote = $db-&gt;query(&quot;INSERT INTO ratings (score, pid, ip) VALUES ('{$score}','{$pid}','{$ipaddy}')&quot;) &amp;&amp; $db-&gt;query(&quot;UPDATE votes SET votecount = votecount +1 WHERE pid='$pid'&quot;);\n\nif ($udVote){\n    if(!count($voteCo)){\n        echo 'no voteCo';\n    }else{\n        foreach ($voteCo as $r){\n            echo escape($r-&gt;votecount);\n        }\n        die();\n    }\n    }else{\n        echo &quot;error updating database&quot;;\n}\n\n\n?&gt;</code></pre>\n\n",
    "PostedDate": "2014-08-17T15:53:23.533-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  },
  {
    "Id": "1291057",
    "ThreadId": "561459",
    "Html": "its ok thanks i sorted it cheers just needed this after a lil bit of a rewrite.<br />\n<pre><code>//update votes count on page load\n        $('.star').each(function () {\n            var pid=$(this).prop('id');\n                $.post('votes.php', { pid:pid } ,onRateResultsSuccess).fail(onRateResultsError);\n        });</code></pre>\n\n",
    "PostedDate": "2014-08-18T07:45:08.34-07:00",
    "UserRole": null,
    "MarkedAsAnswerDate": null
  }
]